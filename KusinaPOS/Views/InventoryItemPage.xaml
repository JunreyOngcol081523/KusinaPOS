<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="KusinaPOS.Views.InventoryItemPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:controls="clr-namespace:KusinaPOS.Views.Controls"
    xmlns:converters="clr-namespace:KusinaPOS.Converters"
    xmlns:inputLayout="clr-namespace:Syncfusion.Maui.Core;assembly=Syncfusion.Maui.Core"
    xmlns:pager="clr-namespace:Syncfusion.Maui.DataGrid.DataPager;assembly=Syncfusion.Maui.DataGrid"
    xmlns:sfbuttons="clr-namespace:Syncfusion.Maui.Buttons;assembly=Syncfusion.Maui.Buttons"
    xmlns:sfdatagrid="clr-namespace:Syncfusion.Maui.DataGrid;assembly=Syncfusion.Maui.DataGrid"
    xmlns:sfeditors="clr-namespace:Syncfusion.Maui.Inputs;assembly=Syncfusion.Maui.Inputs"
    xmlns:viewmodel="clr-namespace:KusinaPOS.ViewModel"
    BackgroundColor="{StaticResource BackgroundDark}">

    <Grid Padding="20" RowDefinitions="Auto,*">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <controls:AppHeaderView
            Grid.Row="0"
            Grid.Column="0"
            Grid.ColumnSpan="2"
            BackgroundColor="Transparent" />

        <!--  Left Panel: Inventory Items List  -->
        <Border
            Grid.Row="1"
            Grid.Column="0"
            Margin="0,0,10,0"
            Padding="20"
            BackgroundColor="{StaticResource Gray100}"
            Stroke="{StaticResource Gray200}"
            StrokeShape="RoundRectangle 10"
            StrokeThickness="1">

            <Grid RowDefinitions="Auto,Auto,*">

                <!--  Header  -->
                <Grid Grid.Row="0" ColumnDefinitions="Auto,*">
                    <Label
                        Grid.Column="0"
                        Margin="0,0,0,8"
                        FontAttributes="Bold"
                        FontSize="Small"
                        HorizontalOptions="Center"
                        Text="Inventory Items List"
                        TextColor="{StaticResource TextPrimary}"
                        VerticalOptions="Center" />

                    <Button
                        Grid.Column="1"
                        BackgroundColor="Transparent"
                        Command="{Binding RefreshInventoryCommand}"
                        HeightRequest="20"
                        HorizontalOptions="End"
                        ImageSource="refresh.png"
                        VerticalOptions="Start" />
                </Grid>

                <!--  Search and Add Button  -->
                <Grid
                    Grid.Row="1"
                    Margin="0,0,0,8"
                    ColumnDefinitions="*,Auto">

                    <SearchBar
                        Grid.Column="0"
                        BackgroundColor="Transparent"
                        FontSize="12"
                        Placeholder="Search"
                        PlaceholderColor="{StaticResource TextDisabled}"
                        Text="{Binding SearchText}"
                        TextColor="{StaticResource TextPrimary}" />

                    <Button
                        Grid.Column="1"
                        Padding="20,10"
                        BackgroundColor="{StaticResource Primary}"
                        Command="{Binding AddItemCommand}"
                        CornerRadius="5"
                        Text="Add Item"
                        TextColor="{StaticResource White}" />
                </Grid>

                <!--  Inventory List  -->
                <Border Grid.Row="2" Style="{StaticResource CardBorder}">
                    <Grid Padding="0" RowDefinitions="*,Auto">
                        <!--  DataGrid  -->
                        <sfdatagrid:SfDataGrid
                            x:Name="inventoryDataGrid"
                            Grid.Row="0"
                            AutoGenerateColumnsMode="None"
                            ColumnWidthMode="Fill"
                            HeaderRowHeight="40"
                            HorizontalScrollBarVisibility="Always"
                            ItemsSource="{Binding Source={x:Reference inventoryPager}, Path=PagedSource}"
                            RowHeight="50"
                            ScrollingMode="Line"
                            SelectedRow="{Binding SelectedItem, Mode=TwoWay}"
                            SelectionMode="None"
                            SortingMode="Single">
                            <sfdatagrid:SfDataGrid.Columns>
                                <!--  Name Column  -->
                                <sfdatagrid:DataGridTextColumn
                                    ColumnWidthMode="Auto"
                                    HeaderText="Name"
                                    MappingName="Name" />

                                <!--  Quantity Column  -->
                                <sfdatagrid:DataGridTextColumn
                                    ColumnWidthMode="Auto"
                                    Format="N0"
                                    HeaderText="Quantity"
                                    MappingName="QuantityOnHand" />

                                <!--  Unit Column  -->
                                <sfdatagrid:DataGridTextColumn
                                    Width="80"
                                    HeaderText="Unit"
                                    MappingName="Unit" />
                                <!--  low stock Column  -->
                                <sfdatagrid:DataGridTextColumn
                                    Width="60"
                                    HeaderText="Low Stock"
                                    MappingName="IsLowStock"
                                    Visible="False" />

                                <!--  Active Column (Switch)  -->
                                <sfdatagrid:DataGridTemplateColumn
                                    Width="80"
                                    ColumnWidthMode="LastColumnFill"
                                    HeaderText="Active"
                                    MappingName="IsActive">
                                    <sfdatagrid:DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Switch
                                                Margin="0,0,10,0"
                                                HorizontalOptions="Center"
                                                IsToggled="{Binding IsActive}"
                                                OnColor="{StaticResource Primary}"
                                                ThumbColor="{StaticResource White}"
                                                VerticalOptions="Center" />
                                        </DataTemplate>
                                    </sfdatagrid:DataGridTemplateColumn.CellTemplate>
                                </sfdatagrid:DataGridTemplateColumn>

                                <!--  Action Column (Edit & View Buttons)  -->
                                <sfdatagrid:DataGridTemplateColumn ColumnWidthMode="Auto" HeaderText="Action">
                                    <sfdatagrid:DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <HorizontalStackLayout
                                                Padding="5,0"
                                                HorizontalOptions="Start"
                                                Spacing="5"
                                                VerticalOptions="Center">
                                                <ImageButton
                                                    BackgroundColor="Transparent"
                                                    Command="{Binding Source={x:Reference inventoryDataGrid}, Path=BindingContext.EditItemCommand}"
                                                    CommandParameter="{Binding .}"
                                                    HeightRequest="15"
                                                    Source="edit.png"
                                                    WidthRequest="15" />

                                                <ImageButton
                                                    BackgroundColor="Transparent"
                                                    Command="{Binding Source={x:Reference inventoryDataGrid}, Path=BindingContext.ViewTransactionsCommand}"
                                                    CommandParameter="{Binding .}"
                                                    HeightRequest="15"
                                                    Source="view.png"
                                                    WidthRequest="15" />
                                            </HorizontalStackLayout>
                                        </DataTemplate>
                                    </sfdatagrid:DataGridTemplateColumn.CellTemplate>
                                </sfdatagrid:DataGridTemplateColumn>
                            </sfdatagrid:SfDataGrid.Columns>

                        </sfdatagrid:SfDataGrid>

                        <!--  DataPager  -->
                        <pager:SfDataPager
                            x:Name="inventoryPager"
                            Grid.Row="1"
                            Margin="0,8,0,8"
                            BackgroundColor="{StaticResource TextSecondary}"
                            HorizontalOptions="Center"
                            NumericButtonCount="5"
                            PageSize="5"
                            Source="{Binding InventoryItems}" />
                    </Grid>
                </Border>
            </Grid>
        </Border>

        <!--  Right Panel: Edit Inventory Item  -->
        <Border
            Grid.Row="1"
            Grid.Column="1"
            Margin="10,0,0,0"
            Padding="20"
            BackgroundColor="{StaticResource Gray100}"
            IsVisible="{Binding IsEditPanelVisible}"
            Stroke="{StaticResource Gray200}"
            StrokeShape="RoundRectangle 10"
            StrokeThickness="1">
            <Grid RowDefinitions="Auto,*,Auto">

                <!--  Header  -->
                <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                    <Label
                        Grid.Column="0"
                        FontAttributes="Bold"
                        FontSize="16"
                        Text="{Binding EditPanelTitle}"
                        TextColor="{StaticResource TextPrimary}"
                        VerticalOptions="Center" />

                    <HorizontalStackLayout Grid.Column="1" Spacing="10">
                        <Label
                            FontSize="14"
                            Text="{Binding EditingIsActive, Converter={StaticResource BoolToStatusConverter}}"
                            TextColor="{StaticResource TextPrimary}"
                            VerticalOptions="Center" />
                        <sfbuttons:SfSwitch
                            HeightRequest="32"
                            IsOn="{Binding EditingIsActive, Mode=TwoWay}"
                            WidthRequest="60" />
                    </HorizontalStackLayout>
                </Grid>

                <!--  Form Fields  -->
                <ScrollView Grid.Row="1">
                    <Grid
                        ColumnDefinitions="*,*"
                        ColumnSpacing="15"
                        RowDefinitions="Auto,Auto,Auto,Auto"
                        RowSpacing="15">

                        <!--  Row 0: Name  -->
                        <VerticalStackLayout
                            Grid.Row="0"
                            Grid.Column="0"
                            Spacing="5"
                            VerticalOptions="End">
                            <inputLayout:SfTextInputLayout
                                ContainerBackground="{StaticResource BackgroundDark}"
                                ContainerType="None"
                                HelperText="Enter the item name"
                                Hint="Name">
                                <Entry
                                    BackgroundColor="Transparent"
                                    Text="{Binding EditingName, Mode=TwoWay}"
                                    TextColor="{StaticResource TextPrimary}" />
                            </inputLayout:SfTextInputLayout>
                        </VerticalStackLayout>

                        <!--  Row 0: Unit  -->
                        <!--  Row 0: Unit / Category Selection  -->
                        <VerticalStackLayout
                            Grid.Row="0"
                            Grid.Column="1"
                            Spacing="10">

                            <!--  Autocomplete for Unit Selection  -->
                            <inputLayout:SfTextInputLayout
                                ContainerBackground="{StaticResource BackgroundDark}"
                                ContainerType="None"
                                HelperText="grams/pcs/kg/liter/bottle"
                                Hint="Unit">
                                <sfeditors:SfAutocomplete
                                    x:Name="autocomplete"
                                    ItemsSource="{Binding UnitMeasurements}"
                                    Placeholder="Select Unit"
                                    SelectedItem="{Binding EditingUnit, Mode=TwoWay}"
                                    TextColor="{StaticResource TextPrimary}" />
                            </inputLayout:SfTextInputLayout>
                        </VerticalStackLayout>



                        <!--  Row 1: Quantity On Hand  -->
                        <VerticalStackLayout
                            Grid.Row="1"
                            Grid.Column="0"
                            Spacing="5">
                            <inputLayout:SfTextInputLayout
                                ContainerBackground="{StaticResource BackgroundDark}"
                                ContainerType="None"
                                HelperText="Current stock quantity"
                                Hint="Quantity On Hand">
                                <Entry
                                    BackgroundColor="Transparent"
                                    Keyboard="Numeric"
                                    Text="{Binding EditingQuantityOnHand, Mode=TwoWay}"
                                    TextColor="{StaticResource TextPrimary}" />
                            </inputLayout:SfTextInputLayout>
                        </VerticalStackLayout>

                        <!--  Row 1: Quantity Changed  -->
                        <VerticalStackLayout
                            Grid.Row="1"
                            Grid.Column="1"
                            Spacing="5">
                            <inputLayout:SfTextInputLayout
                                ContainerBackground="{StaticResource BackgroundDark}"
                                ContainerType="None"
                                HelperText="Auto-calculated"
                                Hint="Quantity Changed (+/-)">
                                <Entry
                                    BackgroundColor="Transparent"
                                    IsEnabled="False"
                                    Keyboard="Numeric"
                                    Text="{Binding DisplayQuantityChanged, Mode=TwoWay}"
                                    TextColor="{StaticResource TextPrimary}" />
                            </inputLayout:SfTextInputLayout>
                        </VerticalStackLayout>

                        <!--  Row 2: Cost Per Unit  -->
                        <VerticalStackLayout
                            Grid.Row="2"
                            Grid.Column="0"
                            Spacing="5">
                            <inputLayout:SfTextInputLayout
                                ContainerBackground="{StaticResource BackgroundDark}"
                                ContainerType="None"
                                HelperText="{Binding CostPerUnitLabel}"
                                Hint="{Binding CostPerUnitLabel}">
                                <Entry
                                    BackgroundColor="Transparent"
                                    Keyboard="Numeric"
                                    Text="{Binding EditingCostPerUnit, Mode=TwoWay}"
                                    TextColor="{StaticResource TextPrimary}" />
                            </inputLayout:SfTextInputLayout>
                        </VerticalStackLayout>

                        <!--  Row 2: Re-Order Level  -->
                        <VerticalStackLayout
                            Grid.Row="2"
                            Grid.Column="1"
                            Spacing="5">
                            <inputLayout:SfTextInputLayout
                                ContainerBackground="{StaticResource BackgroundDark}"
                                ContainerType="None"
                                HelperText="Minimum stock before re-order"
                                Hint="Re-Order Level">
                                <Entry
                                    BackgroundColor="Transparent"
                                    Keyboard="Numeric"
                                    Text="{Binding EditingReOrderLevel, Mode=TwoWay}"
                                    TextColor="{StaticResource TextPrimary}" />
                            </inputLayout:SfTextInputLayout>
                        </VerticalStackLayout>

                        <!--  Row 3: Reason  -->
                        <VerticalStackLayout
                            Grid.Row="3"
                            Grid.Column="0"
                            Spacing="5">
                            <inputLayout:SfTextInputLayout
                                ContainerBackground="{StaticResource BackgroundDark}"
                                ContainerType="None"
                                HelperText="Reason for adjusting quantity"
                                Hint="Reason">
                                <sfeditors:SfComboBox
                                    BackgroundColor="{StaticResource BackgroundDark}"
                                    HeightRequest="45"
                                    IsEnabled="{Binding IsQuantityChanged}"
                                    ItemsSource="{Binding Reasons}"
                                    SelectedItem="{Binding SelectedReason}"
                                    TextColor="{StaticResource TextPrimary}" />
                            </inputLayout:SfTextInputLayout>
                        </VerticalStackLayout>

                        <!--  Row 3: Remarks  -->
                        <VerticalStackLayout
                            Grid.Row="3"
                            Grid.Column="1"
                            Spacing="5">
                            <inputLayout:SfTextInputLayout
                                ContainerBackground="{StaticResource BackgroundDark}"
                                ContainerType="None"
                                HelperText="Additional notes"
                                Hint="Remarks">
                                <Entry
                                    BackgroundColor="Transparent"
                                    Text="{Binding Remarks, Mode=TwoWay}"
                                    TextColor="{StaticResource TextPrimary}" />
                            </inputLayout:SfTextInputLayout>
                        </VerticalStackLayout>

                    </Grid>
                </ScrollView>

                <!--  Action Buttons  -->
                <Grid
                    Grid.Row="2"
                    Margin="0,20,0,0"
                    ColumnDefinitions="*,*"
                    ColumnSpacing="10">
                    <Button
                        Grid.Column="0"
                        Padding="0,12"
                        BackgroundColor="{StaticResource Gray200}"
                        Command="{Binding CancelCommand}"
                        CornerRadius="5"
                        Text="CANCEL"
                        TextColor="{StaticResource TextPrimary}" />
                    <Button
                        Grid.Column="1"
                        Padding="0,12"
                        BackgroundColor="{StaticResource Primary}"
                        Command="{Binding SaveChangesCommand}"
                        CornerRadius="5"
                        Text="SAVE CHANGES"
                        TextColor="{StaticResource White}" />
                </Grid>

            </Grid>
        </Border>

        <!--  Right Panel: Show inventory transaction logs per item  -->
        <Border
            Grid.Row="1"
            Grid.Column="1"
            Margin="10,0,0,0"
            Padding="20"
            BackgroundColor="{StaticResource Gray100}"
            IsVisible="{Binding IsTransactionPanelVisible}"
            Style="{StaticResource CardBorder}">
            <Grid RowDefinitions="Auto,*,Auto">

                <!--  Header  -->
                <Label
                    Grid.Row="0"
                    Margin="0,0,0,20"
                    FontAttributes="Bold"
                    FontSize="16"
                    Text="{Binding TransactionLogPanelTitle, Mode=OneWay}"
                    TextColor="{StaticResource TextPrimary}" />

                <!--  Table  -->

                <!--  Add the namespace for DataPager at the top of your page  -->


                <!--  Update your Grid to include a row for the pager  -->
                <Grid Grid.Row="1" RowDefinitions="*,Auto">

                    <!--  DataGrid  -->
                    <sfdatagrid:SfDataGrid
                        x:Name="transactionDataGrid"
                        Grid.Row="0"
                        AutoGenerateColumnsMode="None"
                        ColumnWidthMode="FitByCell"
                        GridLinesVisibility="Horizontal"
                        HeaderGridLinesVisibility="None"
                        ItemsSource="{Binding Source={x:Reference transactionPager}, Path=PagedSource}"
                        SortingMode="Single">
                        <sfdatagrid:SfDataGrid.Columns>
                            <sfdatagrid:DataGridTextColumn
                                Format="MMM dd, yyyy hh:mm tt"
                                HeaderText="Log Date"
                                MappingName="TransactionDate" />

                            <sfdatagrid:DataGridTextColumn
                                Format="N0"
                                HeaderText="Qty Changed"
                                MappingName="QuantityChange" />

                            <sfdatagrid:DataGridNumericColumn
                                Format="â‚±#,##0.00"
                                HeaderText="Unit Cost"
                                MappingName="CostAtTransaction" />

                            <sfdatagrid:DataGridTextColumn HeaderText="Reason" MappingName="Reason" />

                            <sfdatagrid:DataGridTextColumn HeaderText="Remarks" MappingName="Remarks" />
                        </sfdatagrid:SfDataGrid.Columns>
                    </sfdatagrid:SfDataGrid>

                    <!--  DataPager  -->
                    <pager:SfDataPager
                        x:Name="transactionPager"
                        Grid.Row="1"
                        Margin="0,8,0,0"
                        HorizontalOptions="Center"
                        NumericButtonCount="10"
                        PageSize="5"
                        Source="{Binding TransactionLogs}" />

                </Grid>


                <!--  Close Button  -->
                <Button
                    Grid.Row="2"
                    Padding="0,12"
                    BackgroundColor="{StaticResource Gray200}"
                    Command="{Binding CloseTransactionPanelCommand}"
                    Text="CLOSE"
                    TextColor="{StaticResource TextPrimary}" />

            </Grid>
        </Border>

    </Grid>
</ContentPage>
