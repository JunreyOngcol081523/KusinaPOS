<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:tabView="clr-namespace:Syncfusion.Maui.TabView;assembly=Syncfusion.Maui.TabView"
    x:Class="KusinaPOS.Views.SettingsPage"
    Title="Settings">

    <Grid Padding="16">

        <tabView:SfTabView x:Name="settingTabView">

            <tabView:SfTabView.Items>

                <!-- ================= STORE SETTINGS ================= -->
                <tabView:SfTabItem Header="Store Settings">
                    <ScrollView>
                        <VerticalStackLayout Padding="16" Spacing="12">

                            <Label Text="Store Information"
                           FontSize="18"
                           FontAttributes="Bold" />

                            <Entry Placeholder="Store Name"
                                    Text="{Binding StoreName}" />

                            <Entry Placeholder="Store Address"
                                    Text="{Binding StoreAddress}" />

                            <Label Text="Store Logo"
                                    FontAttributes="Bold" />

                            <VerticalStackLayout
                                                     Spacing="8"
                                                     HeightRequest="220">

                                <Label Text="Item Image"
                                           FontSize="13"
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource TextSecondary}" />

                                <Grid ColumnDefinitions="120,*"
                                        ColumnSpacing="15">

                                    <Border Style="{StaticResource CardBorder}"
                                                Grid.Column="0"
                                                WidthRequest="120"
                                                HeightRequest="120"
                                                BackgroundColor="{StaticResource BackgroundDarker}">
                                        <Image Source="{Binding StoreImageSource}"
                                                   WidthRequest="120"
                                                   HeightRequest="120"
                                                   Aspect="AspectFill" />
                                    </Border>


                                    <Border Grid.Column="1" 
                                            BackgroundColor="{StaticResource Gray200}"
                                                Style="{StaticResource CardBorder}"
                                                Stroke="{StaticResource Primary}"
                                                StrokeThickness="2"
                                                StrokeDashArray="5,5"
                                                Padding="20">
                                        <VerticalStackLayout HorizontalOptions="Center">
                                            <Label Text="ðŸ“" FontSize="32" />
                                            <Label Text="{Binding ImageLabel}"
                                                        FontAttributes="Bold" />
                                            <Label Text="PNG, JPG (max. 5MB)"
                                                       FontSize="11"
                                                       TextColor="{StaticResource Gray500}" />
                                        </VerticalStackLayout>
                                        <Border.GestureRecognizers>
                                            <TapGestureRecognizer Command="{Binding UploadImageCommand}" />
                                        </Border.GestureRecognizers>
                                    </Border>

                                </Grid>
                            </VerticalStackLayout>

                            <Button Text="Save Store Settings"
                                    Command="{Binding SaveStoreSettingsCommand}"
                                    TextColor="White" />

                        </VerticalStackLayout>
                    </ScrollView>
                </tabView:SfTabItem>

                <!-- ================= DATABASE SETTINGS ================= -->
                <tabView:SfTabItem Header="Database Settings">
                    <ScrollView>
                        <VerticalStackLayout Padding="16" Spacing="14">

                            <Label Text="Database Backup"
                                   FontSize="18"
                                   FontAttributes="Bold" />

                            <Button Text="Backup"
                                    Command="{Binding BackupCommand}"
                                    />

                            <!-- Backup List -->
                            <Label Text="Database Backups"
                                    FontAttributes="Bold"
                                    Margin="0,10,0,0"/>

                            <CollectionView ItemsSource="{Binding BackupFiles}">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Border
                                            Stroke="#DDDDDD"
                                            StrokeThickness="1"
                                            Padding="10"
                                            Margin="0,4"
                                            StrokeShape="RoundRectangle 8">

                                            <VerticalStackLayout Spacing="6">

                                                <Label Text="{Binding Name}"
                                                            FontAttributes="Bold" />

                                                <Label Text="{Binding Date}"
                                                       FontSize="12"
                                                       TextColor="Gray" />

                                                <Button HeightRequest="40"
                                                        ImageSource="share.png"
                                                        Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}},
                                                                          Path=BindingContext.DeleteBackupCommand}"
                                                        CommandParameter="{Binding .}" />
                                                <Button 
                                                        HeightRequest="40"
                                                        ImageSource="restore.png"
                                                        Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}},
                                                                          Path=BindingContext.DeleteBackupCommand}"
                                                        CommandParameter="{Binding .}" />
                                                <Button HeightRequest="40"
                                                        ImageSource="delete.png"
                                                        Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}},
                                                                          Path=BindingContext.DeleteBackupCommand}"
                                                        CommandParameter="{Binding .}" />

                                            </VerticalStackLayout>

                                        </Border>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>


                        </VerticalStackLayout>
                    </ScrollView>
                </tabView:SfTabItem>

            </tabView:SfTabView.Items>

        </tabView:SfTabView>


    </Grid>
</ContentPage>
